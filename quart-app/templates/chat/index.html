{% extends "base.html" %}

{% block title %}Chat - Devstral AI{% endblock %}

{% block og_title %}Chat with Devstral AI{% endblock %}
{% block twitter_title %}Chat with Devstral AI{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="bi bi-chat-dots" aria-hidden="true"></i> Chat with AI
            </h1>
            <span class="text-muted">
                <i class="bi bi-person" aria-hidden="true"></i> {{ username }}
            </span>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <!-- Display existing messages -->
                {% if messages %}
                    {% for message in messages %}
                    <article class="message {{ 'user-message' if message.role == 'user' else 'assistant-message' }}">
                        <div class="message-content">
                            <pre>{{ message.content | e }}</pre>
                        </div>
                        {% if message.timestamp %}
                        <small class="text-muted message-timestamp">
                            <time datetime="{{ message.timestamp }}">
                                {{ message.timestamp[:19].replace('T', ' ') }}
                            </time>
                        </small>
                        {% endif %}
                        {% if message.cached and message.role == 'assistant' %}
                        <div class="cached-indicator">
                            <i class="bi bi-lightning-fill" aria-hidden="true"></i> Cached response
                        </div>
                        {% endif %}
                    </article>
                    {% endfor %}
                {% else %}
                    <!-- Welcome message -->
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-chat-dots" style="font-size: 3rem;" aria-hidden="true"></i>
                        <h2>Welcome to Devstral AI Chat</h2>
                        <p>Send a message to start chatting with the AI assistant</p>
                        <small class="text-muted">
                            <i class="bi bi-shield-check" aria-hidden="true"></i> Secure • 
                            <i class="bi bi-lightning" aria-hidden="true"></i> Fast • 
                            <i class="bi bi-cpu" aria-hidden="true"></i> AI-Powered
                        </small>
                    </div>
                {% endif %}
            </div>
            
            <!-- Message input form -->
            <div class="mt-3">
                <form method="POST" action="{{ url_for('chat.chat') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <div class="input-group">
                        <label for="message" class="visually-hidden">Your message</label>
                        <textarea 
                            id="message"
                            name="message" 
                            class="form-control" 
                            placeholder="Type your message... (Max 10,000 characters)" 
                            rows="3" 
                            maxlength="10000"
                            required 
                            autofocus
                            aria-describedby="message-help"
                        ></textarea>
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-send" aria-hidden="true"></i> Send
                        </button>
                    </div>
                    <small id="message-help" class="text-muted">
                        <i class="bi bi-info-circle" aria-hidden="true"></i> 
                        Your message will be processed by the AI and you'll see the response
                    </small>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}