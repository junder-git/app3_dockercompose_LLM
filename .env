# CLEAN .env - Optimized Configuration for Limited VRAM
# =============================================================================

# üîê JWT CONFIGURATION
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-chars

# Domain Configuration
ALLOWED_DOMAINS=localhost,127.0.0.1,ai.junder.uk

# Admin User Configuration
ADMIN_USERNAME=admin1
ADMIN_PASSWORD=admin1
ADMIN_USER_ID=admin

# =============================================================================
# ü§ñ MODEL CONFIGURATION
# =============================================================================
OLLAMA_VERSION=0.9.6
OLLAMA_MODEL=devstral
MODEL_DISPLAY_NAME=Devstral Small 2505
MODEL_DESCRIPTION=Advanced coding and reasoning model optimized for hybrid GPU+CPU processing

# =============================================================================
# ‚ö° OLLAMA SERVER SETTINGS - OPTIMIZED FOR LIMITED VRAM
# =============================================================================
OLLAMA_HOST=0.0.0.0
OLLAMA_URL=http://ollama:11434
OLLAMA_LOAD_TIMEOUT=600s                    # Increased timeout for slow loading

# Memory settings - CRITICAL FIXES
OLLAMA_MMAP=true                            # ENABLED for large models with limited VRAM
OLLAMA_MLOCK=false                          # DISABLED to reduce memory pressure

# Hybrid GPU+CPU settings - REDUCED FOR STABILITY
OLLAMA_GPU_LAYERS=12                         # REDUCED from 41 to 8 (critical fix)
OLLAMA_CONTEXT_SIZE=256                    # REDUCED from 512 to manageable size
OLLAMA_BATCH_SIZE=64                        # REDUCED from 128 to 64
OLLAMA_NUM_THREAD=4                         # INCREASED CPU threads to compensate

# Resource management - OPTIMIZED
OLLAMA_KEEP_ALIVE=99999h                   
OLLAMA_NOPRUNE=0                           # Allow pruning
OLLAMA_MAX_LOADED_MODELS=1                 # Single model
OLLAMA_PARALLEL=1                          # REDUCED parallel processing

# GPU settings
NVIDIA_VISIBLE_DEVICES=0                   # Use GPU 0

# =============================================================================
# üéõÔ∏è MODEL PARAMETERS - REDUCED FOR STABILITY
# =============================================================================

# Core model parameters
MODEL_TEMPERATURE=0.7                      # Reduced from 0.8
MODEL_TOP_P=0.9                           # Default: 0.9  
MODEL_TOP_K=40                            # Default: 40
MODEL_MIN_P=0.0                           # Default: 0.0 (disabled)
MODEL_REPEAT_PENALTY=1.1                  # Default: 1.1
MODEL_REPEAT_LAST_N=64                    # Default: 64

# Context and prediction settings - REDUCED
MODEL_NUM_CTX=256                        # REDUCED from 1024 to stable size
MODEL_NUM_PREDICT=128                     # REDUCED to 512 tokens max
MODEL_SEED=0                              # Default: 0

# Stop sequences
MODEL_STOP_1="<|endoftext|>"             
MODEL_STOP_2="<|im_end|>"                
MODEL_STOP_3="[DONE]"                    
MODEL_STOP_4="<|end|>"                   

# =============================================================================
# üì± APPLICATION SETTINGS
# =============================================================================
RATE_LIMIT_MESSAGES_PER_MINUTE=8         
MAX_MESSAGE_LENGTH=5000                   # REDUCED from 10000

# User Management
MAX_CHATS_PER_USER=1
MAX_PENDING_USERS=2
MIN_USERNAME_LENGTH=3
MAX_USERNAME_LENGTH=12
MIN_PASSWORD_LENGTH=6
MAX_PASSWORD_LENGTH=16

# =============================================================================
# üê≥ DOCKER RESOURCES - OPTIMIZED
# =============================================================================
OLLAMA_MEMORY=15G                         
OLLAMA_CPU=4                              # REDUCED from 6
REDIS_MEMORY=512M                         # REDUCED from 1G
REDIS_CPU=1
NGINX_MEMORY=512M                         # REDUCED from 1G
NGINX_CPU=1

# =============================================================================
# üì¶ REDIS & NETWORK
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_URL=redis://redis:6379/0

# =============================================================================
# üìù LOGGING
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json