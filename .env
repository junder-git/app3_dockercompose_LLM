# .env file - Complete Environment-Driven Configuration
# =============================================================================
# üîß CONFIGURE ME - CHANGE THESE SETTINGS BEFORE DEPLOYMENT
# =============================================================================
# CRITICAL: Change these values for security and customization!

# Quart Application Security (REQUIRED TO CHANGE)
SECRET_KEY=CHANGE-THIS-TO-A-SECURE-RANDOM-STRING-32-CHARACTERS-MINIMUM
ADMIN_USERNAME=admin
ADMIN_PASSWORD=CHANGE-THIS-SECURE-PASSWORD
ADMIN_USER_ID=admin

# Domain Configuration (REQUIRED TO CHANGE)
ALLOWED_DOMAINS=localhost,127.0.0.1,your-domain.com

# Redis Connection (CHANGE IF USING EXTERNAL REDIS)
REDIS_URL=redis://redis:6379/0

# Model Configuration (CHANGE FOR DIFFERENT MODELS)
OLLAMA_MODEL=devstral:24b
MODEL_DISPLAY_NAME=Devstral 24B
MODEL_DESCRIPTION=Devstral - Advanced coding and reasoning model

# Performance Tuning (ADJUST FOR YOUR HARDWARE)
OLLAMA_GPU_LAYERS=12                     # Adjust based on your GPU VRAM
OLLAMA_CONTEXT_SIZE=2048                 # Adjust based on your needs
OLLAMA_BATCH_SIZE=512                    # Increased for faster generation
OLLAMA_NUM_THREAD=8                      # Adjust based on your CPU cores

# User Management (ADJUST FOR YOUR NEEDS)
MAX_CHATS_PER_USER=1                     # Maximum chats per user
MAX_PENDING_USERS=2                      # Maximum pending user registrations
RATE_LIMIT_MESSAGES_PER_MINUTE=100       # INCREASED: Rate limit per user (was 10)

# Resource Limits (ADJUST FOR YOUR SYSTEM)
OLLAMA_MEMORY=16G                        # Total RAM for Ollama
OLLAMA_CPU=4                             # CPU cores for Ollama
QUART_APP_MEMORY=1G                      # RAM for web app
NGINX_MEMORY=1G                          # RAM for nginx

# =============================================================================
# üìä DOCKER COMPOSE RESOURCE LIMITS
# =============================================================================
QUART_APP_MEMORY=1G
QUART_APP_CPU=1
REDIS_MEMORY=1G
REDIS_CPU=1
NGINX_MEMORY=1G
NGINX_CPU=1

# =============================================================================
# üåê NETWORK OPTIMIZATION SETTINGS
# =============================================================================
# Network buffer sizes (bytes)
NET_CORE_RMEM_MAX=134217728
NET_CORE_WMEM_MAX=134217728
NET_IPV4_TCP_RMEM=4096 131072 134217728
NET_IPV4_TCP_WMEM=4096 131072 134217728

# File descriptor limits
ULIMIT_NOFILE_SOFT=65536
ULIMIT_NOFILE_HARD=65536

# Docker network settings
DOCKER_SUBNET=172.21.0.0/16
DOCKER_MTU=9000

# =============================================================================
# UNLIMITED TIMEOUT SETTINGS
# =============================================================================
# Set to 0 for unlimited, or specific seconds
UNLIMITED_TIMEOUT=0
STREAMING_TIMEOUT=0
AIOHTTP_TOTAL_TIMEOUT=0
AIOHTTP_CONNECT_TIMEOUT=0
AIOHTTP_READ_TIMEOUT=0

# =============================================================================
# ü§ñ CURRENT MODEL CONFIGURATION
# =============================================================================
# Models are configured in the "CONFIGURE ME" section above

# =============================================================================
# ‚ö° OLLAMA PERFORMANCE PARAMETERS
# =============================================================================
OLLAMA_HOST=0.0.0.0
OLLAMA_URL=http://ollama:11434
OLLAMA_KEEP_ALIVE=-1                     # Permanent loading
OLLAMA_MAX_LOADED_MODELS=1               # Only one model
OLLAMA_LOAD_TIMEOUT=30m                  # Model loading timeout
OLLAMA_NOPRUNE=1                         # Never unload
OLLAMA_MLOCK=1                           # Lock in RAM/VRAM
OLLAMA_MMAP=0                            # Disable memory mapping
OLLAMA_NUMA=0                            # Disable NUMA
OLLAMA_MAIN_GPU=0                        # Primary GPU

# =============================================================================
# üéõÔ∏è MODELFILE PARAMETERS
# =============================================================================
MODEL_TEMPERATURE=0.7
MODEL_TOP_P=0.9
MODEL_TOP_K=40
MODEL_REPEAT_PENALTY=1.1
MODEL_MIROSTAT=0
MODEL_MIROSTAT_ETA=0.1
MODEL_MIROSTAT_TAU=5.0
MODEL_USE_MMAP=false                     # BOOLEAN: false to disable mmap
MODEL_USE_MLOCK=true                     # BOOLEAN: true to enable mlock
MODEL_STOP_SEQUENCES=["<|endoftext|>", "<|im_end|>", "[DONE]", "<|end|>"]

# =============================================================================
# üì± APPLICATION PERFORMANCE SETTINGS
# =============================================================================
MODEL_MAX_TOKENS=2048                    # Increased max tokens
MODEL_TIMEOUT=0                          # 0 = unlimited timeout
CHAT_HISTORY_LIMIT=15
CHAT_CACHE_TTL_SECONDS=7200
SSE_MAX_CONNECTIONS=25

# =============================================================================
# üë• CHAT AND USER MANAGEMENT SETTINGS
# =============================================================================
RATE_LIMIT_WINDOW=60                     # Rate limit window in seconds
USER_ID_COUNTER_START=1000               # Starting ID for regular users

# =============================================================================
# üñ•Ô∏è NVIDIA GPU SETTINGS
# =============================================================================
NVIDIA_VISIBLE_DEVICES=0
CUDA_MEMORY_FRACTION=0.95
LOG_LEVEL=INFO
LOG_FORMAT=json

# =============================================================================
# üåê QUART WEB APPLICATION
# =============================================================================
SECURE_COOKIES=0                         # Set to 1 for HTTPS
APP_HOST=0.0.0.0
APP_PORT=8000
APP_WORKERS=1
SESSION_LIFETIME_DAYS=7
SSE_HEARTBEAT_INTERVAL=30
SSE_RETRY_TIMEOUT=5000

# =============================================================================
# üîí VALIDATION AND SECURITY SETTINGS
# =============================================================================
MIN_USERNAME_LENGTH=3
MAX_USERNAME_LENGTH=50
MIN_PASSWORD_LENGTH=6
MAX_PASSWORD_LENGTH=128
MAX_MESSAGE_LENGTH=10000
MAX_FILENAME_LENGTH=255
CSRF_TOKEN_LENGTH=32

# =============================================================================
# üì¶ REDIS CONFIGURATION
# =============================================================================
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_KEEPALIVE=true
REDIS_RETRY_ON_TIMEOUT=true
REDIS_DECODE_RESPONSES=true

# =============================================================================
# üöÄ AIOHTTP CLIENT CONFIGURATION
# =============================================================================
AIOHTTP_LIMIT=0                         # 0 = unlimited connections
AIOHTTP_LIMIT_PER_HOST=0                # 0 = unlimited per host
AIOHTTP_KEEPALIVE_TIMEOUT=0             # 0 = unlimited keepalive
AIOHTTP_ENABLE_CLEANUP_CLOSED=false     # Disable cleanup for performance
AIOHTTP_FORCE_CLOSE=false               # Keep connections open
AIOHTTP_TTL_DNS_CACHE=0                 # 0 = unlimited DNS cache