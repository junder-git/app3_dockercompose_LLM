# CORRECTED .env - Consistent Memory Management Settings
# =============================================================================

# üîê JWT CONFIGURATION
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-chars

# Domain Configuration
ALLOWED_DOMAINS=localhost,127.0.0.1,ai.junder.uk

# Admin User Configuration
ADMIN_USERNAME=admin1
ADMIN_PASSWORD=admin1
ADMIN_USER_ID=admin

# =============================================================================
# ü§ñ MODEL CONFIGURATION
# =============================================================================
OLLAMA_VERSION=0.9.6
OLLAMA_MODEL=devstral
MODEL_DISPLAY_NAME=Devstral Small 2505
MODEL_DESCRIPTION=Advanced coding and reasoning model optimized for hybrid GPU+CPU processing

# =============================================================================
# ‚ö° CORRECTED OLLAMA SETTINGS - NO CONFLICTS
# =============================================================================
OLLAMA_HOST=0.0.0.0
OLLAMA_URL=http://ollama:11434
OLLAMA_LOAD_TIMEOUT=45m

# CORRECTED: Memory settings - NO CONFLICTS between server and model
OLLAMA_MMAP=0                            # Server: DISABLED
OLLAMA_MLOCK=1                           # Server: ENABLED
MODEL_USE_MMAP=false                     # Model: DISABLED (matches server)
MODEL_USE_MLOCK=true                     # Model: ENABLED (matches server)

# Enhanced hybrid settings
OLLAMA_GPU_LAYERS=12                     # Enhanced GPU layers
OLLAMA_CONTEXT_SIZE=512                  # 512 context window
OLLAMA_BATCH_SIZE=512                    # Large batch size
OLLAMA_NUM_THREAD=8                      # 8 CPU threads

# Resource management
KEEP_ALIVE=99999                         # Keep alive indefinitely
NOPRUNE=0                                # Allow pruning
MAX_LOADED_MODELS=1                      # Single model

# GPU settings - FIXED: Dynamic allocation
# OLLAMA_GPU_MEMORY_FRACTION=0.8        # REMOVED - Dynamic allocation
NVIDIA_VISIBLE_DEVICES=0                 # Use GPU 0

# =============================================================================
# üéõÔ∏è MODEL PARAMETERS - ENHANCED
# =============================================================================
MODEL_TEMPERATURE=0.7
MODEL_TOP_P=0.9
MODEL_TOP_K=40
MODEL_REPEAT_PENALTY=1
MODEL_MAX_TOKENS=128
MODEL_TIMEOUT=300

# MISSING PARAMETERS - NOW ADDED
MODEL_MIROSTAT=0                         # Disable Mirostat by default
MODEL_MIROSTAT_ETA=0.1                   # Mirostat learning rate
MODEL_MIROSTAT_TAU=5.0                   # Mirostat target entropy
MODEL_STOP_SEQUENCES="<|endoftext|>,<|im_end|>,[DONE],<|end|>"  # Stop sequences

# =============================================================================
# üì± APPLICATION SETTINGS - ENHANCED
# =============================================================================
CHAT_HISTORY_LIMIT=10
RATE_LIMIT_MESSAGES_PER_MINUTE=8         # Enhanced rate limit
MAX_MESSAGE_LENGTH=10000                 # Larger messages

# User Management
MAX_CHATS_PER_USER=1
MAX_PENDING_USERS=2
MIN_USERNAME_LENGTH=3
MAX_USERNAME_LENGTH=12
MIN_PASSWORD_LENGTH=6
MAX_PASSWORD_LENGTH=16

# =============================================================================
# üê≥ DOCKER RESOURCES - ENHANCED
# =============================================================================
OLLAMA_MEMORY=16G
OLLAMA_CPU=4                             # Enhanced CPU allocation
REDIS_MEMORY=1G
REDIS_CPU=1
NGINX_MEMORY=512M
NGINX_CPU=1

# =============================================================================
# üì¶ REDIS & TIMEOUTS
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_URL=redis://redis:6379/0

# Conservative timeouts
UNLIMITED_TIMEOUT=600
STREAMING_TIMEOUT=300

# =============================================================================
# üìù LOGGING
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json